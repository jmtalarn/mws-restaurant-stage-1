{"version":3,"sources":["js/restaurant_info.js"],"names":["restaurant","map","window","initMap","fetchRestaurantFromURL","error","console","self","google","maps","Map","document","getElementById","zoom","center","latlng","scrollwheel","fillBreadcrumb","DBHelper","mapMarkerForRestaurant","callback","id","getParameterByName","fetchRestaurantById","fillRestaurantHTML","innerHTML","name","address","image","setAttribute","title","className","imageSrc","imageUrlForRestaurant","test","replace","onerror","this","src","srcset","sizes","cuisine_type","operating_hours","fillRestaurantHoursHTML","fillReviewsHTML","operatingHours","hours","key","row","createElement","day","appendChild","time","reviews","container","noReviews","ul","forEach","review","createReviewHTML","li","classList","add","date","rating","comments","breadcrumb","a","href","url","location","results","RegExp","exec","decodeURIComponent"],"mappings":"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","file":"../../js/restaurant_info.js","sourcesContent":["/*global google DBHelper*/\r\nlet restaurant;\r\nvar map;\r\n\r\n/**\r\n * Initialize Google map, called from HTML.\r\n */\r\nwindow.initMap = () => {\r\n    fetchRestaurantFromURL((error, restaurant) => {\r\n        if (error) { // Got an error!\r\n            console.error(error);\r\n        } else {\r\n            self.map = new google.maps.Map(document.getElementById('map'), {\r\n                zoom: 16,\r\n                center: restaurant.latlng,\r\n                scrollwheel: false\r\n            });\r\n            fillBreadcrumb();\r\n            DBHelper.mapMarkerForRestaurant(self.restaurant, self.map);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Get current restaurant from page URL.\r\n */\r\nconst fetchRestaurantFromURL = (callback) => {\r\n    if (self.restaurant) { // restaurant already fetched!\r\n        callback(null, self.restaurant)\r\n        return;\r\n    }\r\n    const id = getParameterByName('id');\r\n    if (!id) { // no id found in URL\r\n        const error = 'No restaurant id in URL'\r\n        callback(error, null);\r\n    } else {\r\n        DBHelper.fetchRestaurantById(id, (error, restaurant) => {\r\n            self.restaurant = restaurant;\r\n            if (!restaurant) {\r\n                console.error(error);\r\n                return;\r\n            }\r\n            fillRestaurantHTML();\r\n            callback(null, restaurant);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Create restaurant HTML and add it to the webpage\r\n */\r\nconst fillRestaurantHTML = (restaurant = self.restaurant) => {\r\n    const name = document.getElementById('restaurant-name');\r\n    name.innerHTML = restaurant.name;\r\n\r\n    const address = document.getElementById('restaurant-address');\r\n    address.innerHTML = restaurant.address;\r\n\r\n    const image = document.getElementById('restaurant-img');\r\n    image.setAttribute('alt',`This is a representative image of the restaurant ${restaurant.name}`);\r\n    image.title=`${restaurant.name}`;\r\n    image.className = 'restaurant-img';\r\n    const imageSrc = DBHelper.imageUrlForRestaurant(restaurant);\r\n \r\n    if (!/\\.svg$/.test(imageSrc)){\r\n        image.setAttribute('src' ,imageSrc); \r\n        image.setAttribute('srcset', `${imageSrc.replace(/\\.webp$/,'-small.webp')} 320w,\r\n                                      ${imageSrc.replace(/\\.webp$/,'-medium.webp')} 640w,\r\n                                      ${imageSrc} 800w`);\r\n        image.onerror = ()=>{ this.onerror=null; this.src=this.src.replace(/\\.webp$/,\"jpg\"); this.srcset=`${imageSrc.replace(/\\.webp$/,'-small.jpg')} 320w,\r\n        ${imageSrc.replace(/\\.webp$/,'-medium.jpg')} 640w,\r\n        ${imageSrc.replace(/\\.webp$/,'.jpg')}.jpg 800w` }\r\n\r\n        image.sizes = '(max-width: 800px) 100vw, 800px';\r\n    }\r\n    const cuisine = document.getElementById('restaurant-cuisine');\r\n    cuisine.innerHTML = restaurant.cuisine_type;\r\n\r\n    // fill operating hours\r\n    if (restaurant.operating_hours) {\r\n        fillRestaurantHoursHTML();\r\n    }\r\n    // fill reviews\r\n    fillReviewsHTML();\r\n}\r\n\r\n/**\r\n * Create restaurant operating hours HTML table and add it to the webpage.\r\n */\r\nconst fillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {\r\n    const hours = document.getElementById('restaurant-hours');\r\n    for (let key in operatingHours) {\r\n        const row = document.createElement('tr');\r\n\r\n        const day = document.createElement('th');\r\n        day.innerHTML = key;\r\n        row.appendChild(day);\r\n\r\n        const time = document.createElement('td');\r\n        time.innerHTML = operatingHours[key];\r\n        row.appendChild(time);\r\n\r\n        hours.appendChild(row);\r\n    }\r\n}\r\n\r\n/**\r\n * Create all reviews HTML and add them to the webpage.\r\n */\r\nconst fillReviewsHTML = (reviews = self.restaurant.reviews) => {\r\n    const container = document.getElementById('reviews-container');\r\n    const title = document.createElement('h3');\r\n    title.innerHTML = 'Reviews';\r\n    container.appendChild(title);\r\n\r\n    if (!reviews) {\r\n        const noReviews = document.createElement('p');\r\n        noReviews.innerHTML = 'No reviews yet!';\r\n        container.appendChild(noReviews);\r\n        return;\r\n    }\r\n    const ul = document.getElementById('reviews-list');\r\n    reviews.forEach(review => {\r\n        ul.appendChild(createReviewHTML(review));\r\n    });\r\n    container.appendChild(ul);\r\n}\r\n\r\n/**\r\n * Create review HTML and add it to the webpage.\r\n */\r\nconst createReviewHTML = (review) => {\r\n    const li = document.createElement('li');\r\n    li.setAttribute('tabindex','0');\r\n    \r\n    const name = document.createElement('p');\r\n    name.classList.add('name');\r\n    name.innerHTML = review.name;\r\n    li.appendChild(name);\r\n\r\n    const date = document.createElement('p');\r\n    date.classList.add('date');\r\n    date.innerHTML = review.date;\r\n    li.appendChild(date);\r\n\r\n    const rating = document.createElement('p');\r\n    rating.innerHTML = `Rating: ${review.rating}`;\r\n    rating.classList.add('rating');\r\n    li.appendChild(rating);\r\n\r\n    const comments = document.createElement('p');\r\n    comments.innerHTML = review.comments;\r\n    li.appendChild(comments);\r\n\r\n    return li;\r\n}\r\n\r\n/**\r\n * Add restaurant name to the breadcrumb navigation menu\r\n */\r\nconst fillBreadcrumb = (restaurant=self.restaurant) => {\r\n    const breadcrumb = document.getElementById('breadcrumb');\r\n    const li = document.createElement('li');\r\n    const a = document.createElement('a');\r\n    \r\n    a.setAttribute('disabled','disabled');\r\n    a.innerHTML = restaurant.name;\r\n    a.href='#';\r\n    a.setAttribute('aria-current','page');\r\n\r\n    li.appendChild(a);\r\n    \r\n    breadcrumb.appendChild(li);\r\n}\r\n\r\n/**\r\n * Get a parameter by name from page URL.\r\n */\r\nconst getParameterByName = (name, url) => {\r\n    if (!url)\r\n        url = window.location.href;\r\n    name = name.replace(/[[]]/g, '\\\\$&');\r\n    const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),\r\n        results = regex.exec(url);\r\n    if (!results)\r\n        return null;\r\n    if (!results[2])\r\n        return '';\r\n    return decodeURIComponent(results[2].replace(/\\+/g, ' '));\r\n}\r\n"]}