const CACHE_NAME="mws-restaurant-cache";caches.open(CACHE_NAME).then(function(e){console.log(e);const t=document.getElementById("cached-list");e.keys().then(n=>n.filter(e=>/\.html\?(id=\d*)$/gm.test(e.url)).forEach(n=>{e.match(n).then(e=>e.text()).then(e=>{const a=(new window.DOMParser).parseFromString(e,"text/html").title,r=document.createElement("LI"),s=document.createElement("A");s.href=n.url,s.innerHTML=`${a} ${n.url}`,r.appendChild(s),t.appendChild(r)})}))});class DBHelper{static get DATABASE_URL(){return"http://localhost:8000/data/restaurants.json"}static fetchRestaurants(e){let t=new XMLHttpRequest;t.open("GET",DBHelper.DATABASE_URL),t.onload=(()=>{if(200===t.status){const n=JSON.parse(t.responseText).restaurants;e(null,n)}else{const n=`Request failed. Returned status of ${t.status}`;e(n,null)}}),t.send()}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((a,r)=>{if(a)n(a,null);else{let a=r;"all"!=e&&(a=a.filter(t=>t.cuisine_type==e)),"all"!=t&&(a=a.filter(e=>e.neighborhood==t)),n(null,a)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurants,neighborhoods,cuisines;var markers=[];document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines()});const fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},fetchCuisines=()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=(e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})};window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()});const updateRestaurants=()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,r=e[n].value,s=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e},fillRestaurantsHTML=(e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=e=>{const t=document.createElement("li");t.setAttribute("role","listitem"),t.setAttribute("tabindex","0");const n=`li_title_${e.name.replace(/\s/g,"_")}`;t.setAttribute("aria-labelledby",n);const a=document.createElement("img");a.className="restaurant-img",a.setAttribute("alt",`This is a representative image of the restaurant ${e.name}`),a.setAttribute("tabindex","0"),a.title=`${e.name}`;const r=DBHelper.imageUrlForRestaurant(e);a.src=`${r.slice(0,r.lastIndexOf("."))}-small${r.slice(r.lastIndexOf("."))}`,t.append(a);const s=document.createElement("div");s.className="restaurant-description";const l=document.createElement("h2");l.id=n,l.innerHTML=e.name,s.append(l);const i=document.createElement("p");i.innerHTML=e.neighborhood,s.append(i);const o=document.createElement("p");o.innerHTML=e.address,s.append(o);const c=document.createElement("a");return c.innerHTML="View Details",c.href=DBHelper.urlForRestaurant(e),s.append(c),t.append(s),t},addMarkersToMap=(e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})};let restaurant;var map;"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("./sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})}),window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})});const fetchRestaurantFromURL=e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");if(t)DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)});else{e("No restaurant id in URL",null)}},fillRestaurantHTML=(e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.setAttribute("alt",`This is a representative image of the restaurant ${e.name}`),t.title=`${e.name}`,t.className="restaurant-img";const n=DBHelper.imageUrlForRestaurant(e);t.src=n,t.srcset=`${n.slice(0,n.lastIndexOf("."))}-small${n.slice(n.lastIndexOf("."))} 320w,\n                                    ${n.slice(0,n.lastIndexOf("."))}-medium${n.slice(n.lastIndexOf("."))} 640w,\n                                    ${n} 800w`,t.sizes="(max-width: 800px) 100vw, 800px",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=(e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("th");r.innerHTML=n,a.appendChild(r);const s=document.createElement("td");s.innerHTML=e[n],a.appendChild(s),t.appendChild(a)}},fillReviewsHTML=(e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h3");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const a=document.getElementById("reviews-list");e.forEach(e=>{a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=e=>{const t=document.createElement("li");t.setAttribute("tabindex","0");const n=document.createElement("p");n.classList.add("name"),n.innerHTML=e.name,t.appendChild(n);const a=document.createElement("p");a.classList.add("date"),a.innerHTML=e.date,t.appendChild(a);const r=document.createElement("p");r.innerHTML=`Rating: ${e.rating}`,r.classList.add("rating"),t.appendChild(r);const s=document.createElement("p");return s.innerHTML=e.comments,t.appendChild(s),t},fillBreadcrumb=(e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li"),a=document.createElement("a");a.setAttribute("disabled","disabled"),a.innerHTML=e.name,a.href="#",a.setAttribute("aria-current","page"),n.appendChild(a),t.appendChild(n)},getParameterByName=(e,t)=>{t||(t=window.location.href),e=e.replace(/[[]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhY2hlZC5qcyIsImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIiwicmVnaXN0ZXIuanMiXSwibmFtZXMiOlsiQ0FDSEVfTkFNRSIsImNhY2hlcyIsIm9wZW4iLCJ0aGVuIiwiY2FjaGUiLCJjb25zb2xlIiwibG9nIiwibGlzdCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJrZXlzIiwiZmlsdGVyIiwicmVxdWVzdCIsInRlc3QiLCJ1cmwiLCJmb3JFYWNoIiwibWF0Y2giLCJyZXNwb25zZSIsInRleHQiLCJyZXNwb25zZVRleHQiLCJ0aXRsZSIsIndpbmRvdyIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsImxpIiwiY3JlYXRlRWxlbWVudCIsImxpbmsiLCJocmVmIiwiaW5uZXJIVE1MIiwiYXBwZW5kQ2hpbGQiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImNhbGxiYWNrIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvbmxvYWQiLCJzdGF0dXMiLCJyZXN0YXVyYW50cyIsIkpTT04iLCJwYXJzZSIsImVycm9yIiwic2VuZCIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsIm5hbWUiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsInNlbGVjdCIsIm9wdGlvbiIsInZhbHVlIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsImluaXRNYXAiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwibGF0IiwibG5nIiwic2Nyb2xsd2hlZWwiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwibSIsInNldE1hcCIsInVsIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJhZGRNYXJrZXJzVG9NYXAiLCJzZXRBdHRyaWJ1dGUiLCJ0aXRsZV9pZCIsInJlcGxhY2UiLCJpbWFnZSIsImNsYXNzTmFtZSIsImltYWdlU3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50Iiwic3JjIiwic2xpY2UiLCJsYXN0SW5kZXhPZiIsImRpdiIsImFkZHJlc3MiLCJtb3JlIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJwdXNoIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwicmVnaXN0cmF0aW9uIiwic2NvcGUiLCJjYXRjaCIsImVyciIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJmaWxsQnJlYWRjcnVtYiIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJzcmNzZXQiLCJzaXplcyIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImRheSIsInRpbWUiLCJyZXZpZXdzIiwiY29udGFpbmVyIiwibm9SZXZpZXdzIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImNsYXNzTGlzdCIsImFkZCIsImRhdGUiLCJyYXRpbmciLCJjb21tZW50cyIsImJyZWFkY3J1bWIiLCJhIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBQUEsV0FBQSx1QkFFQUMsT0FBQUMsS0FBQUYsWUFBQUcsS0FBQSxTQUFBQyxHQUNBQyxRQUFBQyxJQUFBRixHQUNBLE1BQUFHLEVBQUFDLFNBQUFDLGVBQUEsZUFDQUwsRUFBQU0sT0FDQVAsS0FBQU8sR0FBQUEsRUFDQUMsT0FBQUMsR0FBQSxzQkFBQUMsS0FBQUQsRUFBQUUsTUFDQUMsUUFBQUgsSUFDQVIsRUFBQVksTUFBQUosR0FDQVQsS0FBQWMsR0FBQUEsRUFBQUMsUUFDQWYsS0FBQWdCLElBRUEsTUFBQUMsR0FEQSxJQUFBQyxPQUFBQyxXQUFBQyxnQkFBQUosRUFBQSxhQUNBQyxNQUVBSSxFQUFBaEIsU0FBQWlCLGNBQUEsTUFDQUMsRUFBQWxCLFNBQUFpQixjQUFBLEtBQ0FDLEVBQUFDLEtBQUFmLEVBQUFFLElBQ0FZLEVBQUFFLGFBQUFSLEtBQUFSLEVBQUFFLE1BQ0FVLEVBQUFLLFlBQUFILEdBQ0FuQixFQUFBc0IsWUFBQUwsZ0JDaEJBTSxTQU1BQywwQkFFQSxNQUFBLDhDQU1BQyx3QkFBQUMsR0FDQSxJQUFBQyxFQUFBLElBQUFDLGVBQ0FELEVBQUFoQyxLQUFBLE1BQUE0QixTQUFBQyxjQUNBRyxFQUFBRSxPQUFBLE1BQ0EsR0FBQSxNQUFBRixFQUFBRyxPQUFBLENBQ0EsTUFDQUMsRUFEQUMsS0FBQUMsTUFBQU4sRUFBQWYsY0FDQW1CLFlBQ0FMLEVBQUEsS0FBQUssT0FDQSxDQUNBLE1BQUFHLHdDQUFBUCxFQUFBRyxTQUNBSixFQUFBUSxFQUFBLFNBR0FQLEVBQUFRLE9BTUFWLDJCQUFBVyxFQUFBVixHQUVBSCxTQUFBYyxpQkFBQSxDQUFBSCxFQUFBSCxLQUNBLEdBQUFHLEVBQ0FS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LEVBQUEsR0FBQXlELFFBQUEsTUFBQSxNQURBLEdBRkEiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IENBQ0hFX05BTUUgPSAnbXdzLXJlc3RhdXJhbnQtY2FjaGUnO1xyXG5cclxuY2FjaGVzLm9wZW4oQ0FDSEVfTkFNRSkudGhlbihmdW5jdGlvbihjYWNoZSkge1xyXG4gICAgY29uc29sZS5sb2coY2FjaGUpO1xyXG4gICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWNoZWQtbGlzdCcpO1xyXG4gICAgY2FjaGUua2V5cygpXHJcbiAgICAgICAgLnRoZW4oa2V5cz0+a2V5c1xyXG4gICAgICAgICAgICAuZmlsdGVyKHJlcXVlc3Q9Pi9cXC5odG1sXFw/KGlkPVxcZCopJC9nbS50ZXN0KHJlcXVlc3QudXJsKSApXHJcbiAgICAgICAgICAgIC5mb3JFYWNoKHJlcXVlc3Q9PntcclxuICAgICAgICAgICAgICAgIGNhY2hlLm1hdGNoKHJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2U9PnJlc3BvbnNlLnRleHQoKSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZVRleHQ9PntcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlZFJlc3BvbnNlID0gKG5ldyB3aW5kb3cuRE9NUGFyc2VyKCkpLnBhcnNlRnJvbVN0cmluZyhyZXNwb25zZVRleHQsICd0ZXh0L2h0bWwnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBwYXJzZWRSZXNwb25zZS50aXRsZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnTEknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0EnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluay5ocmVmID0gcmVxdWVzdC51cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsuaW5uZXJIVE1MID0gYCR7dGl0bGV9ICR7cmVxdWVzdC51cmx9YDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGkuYXBwZW5kQ2hpbGQobGluayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQobGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pOyAgXHJcbiAgICAgICAgICAgIH0pKTtcclxufSk7IiwiLypnbG9iYWwgZ29vZ2xlKi9cclxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgICAgICBjb25zdCBwb3J0ID0gODAwMDsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L2RhdGEvcmVzdGF1cmFudHMuanNvbmA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgIHhoci5vcGVuKCdHRVQnLCBEQkhlbHBlci5EQVRBQkFTRV9VUkwpO1xyXG4gICAgICAgIHhoci5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHsgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcclxuICAgICAgICAgICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBqc29uLnJlc3RhdXJhbnRzO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICAgICAgICB9IGVsc2UgeyAvLyBPb3BzIS4gR290IGFuIGVycm9yIGZyb20gc2VydmVyLlxyXG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWApO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB4aHIuc2VuZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZClcclxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcclxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICAgICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1B9XHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gbWFya2VyO1xyXG4gICAgfVxyXG5cclxufVxyXG4iLCIvKmdsb2JhbCBnb29nbGUgREJIZWxwZXIqL1xyXG5sZXQgcmVzdGF1cmFudDtcclxudmFyIG1hcDtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICAgIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgICAgICAgICAgem9vbTogMTYsXHJcbiAgICAgICAgICAgICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICAgICAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICAgICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmNvbnN0IGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcclxuICAgIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xyXG4gICAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcclxuICAgICAgICBjb25zdCBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xyXG4gICAgICAgICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xyXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuY29uc3QgZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICAgIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XHJcbiAgICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuXHJcbiAgICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xyXG4gICAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcblxyXG4gICAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcclxuICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnYWx0JyxgVGhpcyBpcyBhIHJlcHJlc2VudGF0aXZlIGltYWdlIG9mIHRoZSByZXN0YXVyYW50ICR7cmVzdGF1cmFudC5uYW1lfWApO1xyXG4gICAgaW1hZ2UudGl0bGU9YCR7cmVzdGF1cmFudC5uYW1lfWA7XHJcbiAgICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnXHJcbiAgICBjb25zdCBpbWFnZVNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICAgIGltYWdlLnNyYyA9IGltYWdlU3JjO1xyXG4gICAgXHJcbiAgICBpbWFnZS5zcmNzZXQgPSBgJHtpbWFnZVNyYy5zbGljZSgwLCBpbWFnZVNyYy5sYXN0SW5kZXhPZignLicpKX0tc21hbGwke2ltYWdlU3JjLnNsaWNlKGltYWdlU3JjLmxhc3RJbmRleE9mKCcuJykpfSAzMjB3LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2ltYWdlU3JjLnNsaWNlKDAsIGltYWdlU3JjLmxhc3RJbmRleE9mKCcuJykpfS1tZWRpdW0ke2ltYWdlU3JjLnNsaWNlKGltYWdlU3JjLmxhc3RJbmRleE9mKCcuJykpfSA2NDB3LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2ltYWdlU3JjfSA4MDB3YDtcclxuICAgIGltYWdlLnNpemVzID0gYChtYXgtd2lkdGg6IDgwMHB4KSAxMDB2dywgODAwcHhgO1xyXG5cclxuICAgIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XHJcbiAgICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xyXG5cclxuICAgIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXHJcbiAgICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgICAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xyXG4gICAgfVxyXG4gICAgLy8gZmlsbCByZXZpZXdzXHJcbiAgICBmaWxsUmV2aWV3c0hUTUwoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcclxuICAgIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcclxuICAgIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7XHJcbiAgICAgICAgZGF5LmlubmVySFRNTCA9IGtleTtcclxuICAgICAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcclxuXHJcbiAgICAgICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICAgICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcclxuXHJcbiAgICAgICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xyXG4gICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xyXG4gICAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcclxuXHJcbiAgICBpZiAoIXJldmlld3MpIHtcclxuICAgICAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgICAgICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICAgICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcclxuICAgIH0pO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcclxuICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICAgIGxpLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCcwJyk7XHJcbiAgICBcclxuICAgIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgICBuYW1lLmNsYXNzTGlzdC5hZGQoJ25hbWUnKTtcclxuICAgIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XHJcbiAgICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcclxuXHJcbiAgICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgZGF0ZS5jbGFzc0xpc3QuYWRkKCdkYXRlJyk7XHJcbiAgICBkYXRlLmlubmVySFRNTCA9IHJldmlldy5kYXRlO1xyXG4gICAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XHJcblxyXG4gICAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG4gICAgcmF0aW5nLmNsYXNzTGlzdC5hZGQoJ3JhdGluZycpO1xyXG4gICAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcclxuICAgIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuXHJcbiAgICByZXR1cm4gbGk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxyXG4gKi9cclxuY29uc3QgZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICAgIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xyXG4gICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgIFxyXG4gICAgYS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywnZGlzYWJsZWQnKTtcclxuICAgIGEuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gICAgYS5ocmVmPScjJztcclxuICAgIGEuc2V0QXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnLCdwYWdlJyk7XHJcblxyXG4gICAgbGkuYXBwZW5kQ2hpbGQoYSk7XHJcbiAgICBcclxuICAgIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmNvbnN0IGdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcclxuICAgIGlmICghdXJsKVxyXG4gICAgICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gICAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1tdXS9nLCAnXFxcXCQmJyk7XHJcbiAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgICAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xyXG4gICAgaWYgKCFyZXN1bHRzKVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgaWYgKCFyZXN1bHRzWzJdKVxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XHJcbn1cclxuIiwiLyoqKlxyXG4gKiBSZWdpc3RlciBTZXJ2aWNlIHdvcmtlclxyXG4gKi9cclxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcuL3N3LmpzJykudGhlbihmdW5jdGlvbiAocmVnaXN0cmF0aW9uKSB7XHJcbiAgICAgICAgICAgIC8vIFJlZ2lzdHJhdGlvbiB3YXMgc3VjY2Vzc2Z1bFxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciByZWdpc3RyYXRpb24gc3VjY2Vzc2Z1bCB3aXRoIHNjb3BlOiAnLCByZWdpc3RyYXRpb24uc2NvcGUpO1xyXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgLy8gcmVnaXN0cmF0aW9uIGZhaWxlZCA6KFxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciByZWdpc3RyYXRpb24gZmFpbGVkOiAnLCBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0iXX0=
